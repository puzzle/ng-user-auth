/*!
 * ng-user-auth 2.0.0
 * (c) 2017 Puzzle ITC <info@puzzle.ch>
 * License: Apache-2.0
 */
(function (e, n) {
  if ('object' == typeof exports && 'object' == typeof module) module.exports = n(require(void 0), require(void 0), require(void 0), require(void 0)); else if ('function' == typeof define && define.amd) define([, , ,], n); else {
    var t = 'object' == typeof exports ? n(require('angular'), require('angular-local-storage'), require('angular-ui-router'), require('lodash')) : n(e.angular, e.null, e.null, e._);
    for (var r in t) ('object' == typeof exports ? exports : e)[r] = t[r]
  }
})(this, (function (e, n, t, r) {
  return (function (e) {
    function n(r) {
      if (t[r]) return t[r].exports;
      var o = t[r] = { i: r, l: !1, exports: {} };
      return e[r].call(o.exports, o, o.exports, n), o.l = !0, o.exports
    }

    var t = {};
    return n.m = e, n.c = t, n.i = function (e) {
      return e
    }, n.d = function (e, t, r) {
      n.o(e, t) || Object.defineProperty(e, t, { configurable: !1, enumerable: !0, get: r })
    }, n.n = function (e) {
      var t = e && e.__esModule ? function () {
        return e.default
      } : function () {
        return e
      };
      return n.d(t, 'a', t), t
    }, n.o = function (e, n) {
      return Object.prototype.hasOwnProperty.call(e, n)
    }, n.p = '', n(n.s = 8)
  })([(function (n, t) {
    n.exports = e
  }), (function (e, n, t) {
    'use strict';
    n.__esModule = !0;
    var r = t(0), o = (function (e) {
      return e && e.__esModule ? e : { default: e }
    })(r), u = t(11), i = (function (e) {
      if (e && e.__esModule) return e;
      var n = {};
      if (null != e) for (var t in e) Object.prototype.hasOwnProperty.call(e, t) && (n[t] = e[t]);
      return n.default = e, n
    })(u);
    n.default = o.default.module('ngLodash', []).constant('lodash', i).name
  }), (function (e, n, t) {
    'use strict';

    function r(e) {
      return e && e.__esModule ? e : { default: e }
    }

    function o() {
      function e(e, a, c, f, d, l) {
        function g() {
          O = f(v, s.interval)
        }

        function h() {
          O && f.cancel(O)
        }

        function v() {
          m().get(s.checkUrl).catch((function (e) {
            s && d.isFunction(s.onSessionInvalid) && s.onSessionInvalid(e), h()
          }))
        }

        function m() {
          return a.get('$http')
        }

        function p(e) {
          d.forEach(u, (function (e) {
            e(a)
          })), h();
          var n = c.path(), o = A(n);
          '/' === c.$$search[r] && e && e.url ? c.url(t + '?' + r + '=' + e.url) : !(n.indexOf(t) < 0) || o && o.data && o.data.anonymousAccessAllowed || c.url(t + '?' + r + '=' + n)
        }

        function A(e) {
          var n = a.get('$state').get();
          return n[d.findIndex(n, (function (n) {
            return n.url === e
          }))]
        }

        function _() {
          var e = E();
          return !!e && d.isString(e)
        }

        function $(e) {
          return N = m().post(n, e).then((function (e) {
            k(e), g()
          }))
        }

        function P() {
          return h(), m().delete(n, { noCancelOnRouteChange: !0 }).finally((function () {
            x()
          }))
        }

        function U() {
          return n
        }

        function y() {
          return o
        }

        function S() {
          return i
        }

        function I() {
          return N || (N = m().get(n).then(k)), N
        }

        function k(n) {
          var t = n.data;
          return t.token && (C = t.token, l.set(L, C), e.$broadcast(b, !0)), e.$broadcast(M, t), t
        }

        function E() {
          return C && !d.isEmpty(C) && d.isString(C) || (C = l.get(L)) && e.$broadcast(b, !0), C
        }

        function x() {
          C = null, l.remove(L), e.$broadcast(b, !1), e.$broadcast(M, { user: null, permissions: [] }), N = null
        }

        var M = 'ngUserAuth:userPermissionsChanged', b = 'ngUserAuth:userLoginStateChanged', L = 'user.token',
          C = void 0, N = void 0, O = void 0, T = {
            isLoggedIn: _,
            login: $,
            logout: P,
            getApiEndpoint: U,
            getAbortRequestsUrlPrefix: y,
            getDefaultLoggedInPermissionName: S,
            getUserToken: E,
            clearUserToken: x,
            getUserAuthInfo: I,
            goToLoginScreen: p,
            AUTH_INFO_CHANGED_EVENT_NAME: M,
            LOGIN_STATE_CHANGED_EVENT_NAME: b
          };
        return (function () {
          s && !0 === s.enabled && _() && g()
        })(), T
      }

      e.$inject = ['$rootScope', '$injector', '$location', '$interval', 'lodash', 'localStorageService'];
      var n = '/authentication', t = '/unauthorized', r = 'requestedPath', o = '/', u = [], i = 'token_read', s = {
        enabled: !1, checkUrl: '/sessioncheck', interval: 3e4, onSessionInvalid: function () {
        }
      };
      this.setApiEndpoint = function (e) {
        n = e
      }, this.setUnauthorizedUrl = function (e) {
        t = e
      }, this.setRequestedPathParameterName = function (e) {
        r = e
      }, this.setAbortRequestsUrlPrefix = function (e) {
        o = e
      }, this.addLogoutAction = function (e) {
        u.push(e)
      }, this.setDefaultLoggedInPermissionName = function (e) {
        i = e
      }, this.setSessionCheckSettings = function (e) {
        s = e
      }, this.getOtherwiseRouteHandler = function (e) {
        var n = !1;
        return function (t, r) {
          var o = t.get('ngUserAuthService'), u = r.path(), i = encodeURIComponent(e);
          (o.isLoggedIn() || u.indexOf(e) < 0 && u.indexOf(i) < 0) && (n || (r.url(e), n = !0))
        }
      }, this.$get = e
    }

    n.__esModule = !0;
    var u = t(0), i = r(u);
    t(9);
    var s = t(1), a = r(s);
    n.default = i.default.module('ngUserAuth.service', ['LocalStorageModule', a.default]).provider('ngUserAuthService', o).name
  }), (function (e, n, t) {
    'use strict';

    function r(e) {
      return e && e.__esModule ? e : { default: e }
    }

    function o(e, n, t, r) {
      function o(e) {
        t.$on(n.AUTH_INFO_CHANGED_EVENT_NAME, (function (n, t) {
          e(t)
        }))
      }

      function u() {
        return A
      }

      function i() {
        return P.promise
      }

      function s() {
        return U
      }

      function a() {
        return _
      }

      function c(e) {
        P.resolve(), U = !0, _ = e.user, $ = e.permissions
      }

      function f(e) {
        P.reject(e), U = !0
      }

      function d(e) {
        var n = m(e);
        return 0 === n.length || h(n)
      }

      function l(e) {
        var n = m(e);
        return 0 === n.length || v(n)
      }

      function g(e) {
        var n = m(e);
        return 0 === n.length || !v(n)
      }

      function h(e) {
        return r.every(e, (function (e) {
          return r.includes($, e)
        }))
      }

      function v(e) {
        return r.some(e, (function (e) {
          return r.includes($, e)
        }))
      }

      function m(e) {
        return void 0 === e || r.isEmpty(e) ? [] : r.isArray(e) ? e : [e]
      }

      function p(e, n, t) {
        return d(e) && l(n) && g(t)
      }

      var A = void 0, _ = void 0, $ = void 0, P = void 0, U = void 0, y = {
        notifyOnAuthChange: o,
        isLoggedIn: u,
        isReady: s,
        whenReady: i,
        getUser: a,
        userHasPermission: d,
        userHasAnyPermission: l,
        userLacksPermission: g,
        checkPermissions: p
      };
      return (function () {
        A = n.isLoggedIn(), t.$on(n.LOGIN_STATE_CHANGED_EVENT_NAME, (function (e, n) {
          A = n
        })), P = e.defer(), U = !1, n.getUserAuthInfo().then(c, f), o(c)
      })(), y
    }

    o.$inject = ['$q', 'ngUserAuthService', '$rootScope', 'lodash'], n.__esModule = !0;
    var u = t(0), i = r(u), s = t(1), a = r(s), c = t(2), f = r(c);
    n.default = i.default.module('ngUserAuthInfo.service', [a.default, f.default]).factory('ngUserAuthInfoService', o).name
  }), (function (e, n, t) {
    'use strict';

    function r(e) {
      return e && e.__esModule ? e : { default: e }
    }

    function o(e, n) {
      function t(e) {
        var t = e || {}, r = n.getAbortRequestsUrlPrefix();
        r && t.url.indexOf(r) < 0 && (t.noCancelOnRouteChange = !0), void 0 !== t.timeout || t.noCancelOnRouteChange || (t.$timeout = u(), t.timeout = t.$timeout.promise);
        var o = n.getUserToken();
        return o && (t.headers = t.headers || {}, t.headers.Authorization = 'Bearer ' + o), t
      }

      function r(e) {
        return s(e.config), e
      }

      function o(t) {
        return t.config && t.config.timeout && t.config.timeout.isGloballyCancelled ? e.defer().promise : (s(t.config), 401 === t.status ? (a(), n.clearUserToken(), n.goToLoginScreen()) : 403 === t.status && (t.hasNoAccess = !0), e.reject(t))
      }

      function u() {
        var n = e.defer();
        return c.push(n), n
      }

      function s(e) {
        if (e && e.$timeout) {
          var n = c.indexOf(e.$timeout);
          n >= 0 && c.splice(n, 1)
        }
      }

      function a() {
        i.default.forEach(c, (function (e) {
          e.promise.isGloballyCancelled = !0, e.resolve()
        })), c.length = 0
      }

      var c = [];
      return { request: t, response: r, responseError: o }
    }

    o.$inject = ['$q', 'ngUserAuthService'], n.__esModule = !0;
    var u = t(0), i = r(u), s = t(2), a = r(s);
    n.default = i.default.module('ngUserAuth.interceptor', [a.default]).factory('ngUserAuthInterceptor', o).name
  }), (function (e, n, t) {
    'use strict';

    function r(e) {
      return e && e.__esModule ? e : { default: e }
    }

    function o(e) {
      e.interceptors.push('ngUserAuthInterceptor')
    }

    o.$inject = ['$httpProvider'], n.__esModule = !0;
    var u = t(0), i = r(u), s = t(4), a = r(s);
    n.default = i.default.module('ngUserAuth.config', [a.default]).config(o).name
  }), (function (e, n, t) {
    'use strict';

    function r(e) {
      return e && e.__esModule ? e : { default: e }
    }

    function o(e, n) {
      return { link: s(e, n, 'uaPermission', n.userHasPermission) }
    }

    function u(e, n) {
      return { link: s(e, n, 'uaAnyPermission', n.userHasAnyPermission) }
    }

    function i(e, n) {
      return { link: s(e, n, 'uaLacksPermission', n.userLacksPermission) }
    }

    function s(e, n, t, r) {
      return function (o, u, i) {
        function s() {
          r(c) ? u.show() : u.hide()
        }

        var a = e.$new(!0), c = a.$eval(i[t]) || i[t];
        s(), n.notifyOnAuthChange(s)
      }
    }

    o.$inject = ['$rootScope', 'ngUserAuthInfoService'], u.$inject = ['$rootScope', 'ngUserAuthInfoService'], i.$inject = ['$rootScope', 'ngUserAuthInfoService'], n.__esModule = !0;
    var a = t(0), c = r(a), f = t(3), d = r(f);
    n.default = c.default.module('ngUserAuth.directive', [d.default]).directive('uaPermission', o).directive('uaAnyPermission', u).directive('uaLacksPermission', i).name
  }), (function (e, n, t) {
    'use strict';

    function r(e) {
      return e && e.__esModule ? e : { default: e }
    }

    function o(e, n, t, r, o) {
      function u(e, n, u) {
        if (!n.data || !n.data.anonymousAccessAllowed) {
          var i = s(n);
          i.needsCheck && (r.whenReady().then((function () {
            var s = r.checkPermissions(i.hasPermission, i.hasAnyPermission, i.lacksPermission);
            r.isLoggedIn() ? s ? e.defaultPrevented && o.go(n.name, u) : c(i.redirectTo, u) : t.goToLoginScreen(n)
          }), (function () {
            return o.go('error', u)
          })), r.isReady() && r.isLoggedIn() || e.preventDefault())
        }
      }

      function s(e) {
        var n = [], r = void 0, o = void 0, u = void 0;
        return e.data && (n = a(e.data.hasPermission), r = e.data.hasAnyPermission, o = e.data.lacksPermission, u = e.data.redirectTo), e && e.data && e.data.anonymousAccessAllowed || n.push(t.getDefaultLoggedInPermissionName()), {
          hasPermission: n,
          hasAnyPermission: r,
          lacksPermission: o,
          redirectTo: u,
          needsCheck: n.length > 0 || r || o
        }
      }

      function a(e) {
        return e ? n.isArray(e) ? e : [e] : []
      }

      function c(e, n) {
        var t = e;
        return t ? (i.default.isFunction(t) && (t = t()), o.go(t, n)) : o.go('forbidden', n)
      }

      e.$on('$stateChangeStart', u)
    }

    o.$inject = ['$rootScope', 'lodash', 'ngUserAuthService', 'ngUserAuthInfoService', '$state'], n.__esModule = !0;
    var u = t(0), i = r(u);
    t(10);
    var s = t(1), a = r(s), c = t(2), f = r(c), d = t(3), l = r(d);
    n.default = i.default.module('ngUserAuth.run', ['ui.router', a.default, f.default, l.default]).run(o).name
  }), (function (e, n, t) {
    'use strict';

    function r(e) {
      return e && e.__esModule ? e : { default: e }
    }

    n.__esModule = !0;
    var o = t(0), u = r(o), i = t(1), s = r(i), a = t(5), c = r(a), f = t(6), d = r(f), l = t(7), g = r(l), h = t(3),
      v = r(h), m = t(4), p = r(m), A = t(2), _ = r(A);
    n.default = u.default.module('ngUserAuth', [s.default, c.default, d.default, p.default, g.default, _.default, v.default]).name
  }), (function (e, t) {
    e.exports = n
  }), (function (e, n) {
    e.exports = t
  }), (function (e, n) {
    e.exports = r
  })])
}));
