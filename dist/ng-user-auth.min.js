/**
 * ng-user-auth 1.1.1
 * (c) 2017 
 * License: Apache-2.0
 */
!function(){"use strict";function n(){function n(n,c,a,f,g,h){function l(){u&&u.enabled===!0&&p()&&d()}function d(){O=f(v,u.interval)}function A(){O&&f.cancel(O)}function v(){m().get(u.checkUrl)["catch"](function(n){u&&g.isFunction(u.onSessionInvalid)&&u.onSessionInvalid(n),A()})}function m(){return c.get("$http")}function U(n){g.forEach(i,function(n){n(c)}),A();var e=a.path(),o=$(e);"/"===a.$$search[r]&&n&&n.url?a.url(t+"?"+r+"="+n.url):!(e.indexOf(t)<0)||o&&o.data&&o.data.anonymousAccessAllowed||a.url(t+"?"+r+"="+e)}function $(n){var e=c.get("$state").get(),t=g.findIndex(e,function(e){return e.url===n});return e[t]}function p(){var n=L();return!!n&&g.isString(n)}function P(n){return _=m().post(e,n).then(function(n){C(n),d()})}function I(){return A(),m()["delete"](e,{noCancelOnRouteChange:!0})["finally"](function(){N()})}function S(){return e}function y(){return o}function E(){return s}function k(){return _||(_=m().get(e).then(C)),_}function C(e){var t=e.data;return t.token&&(T=t.token,h.set(j,T),n.$broadcast(R,!0)),n.$broadcast(b,t),t}function L(){return T&&!g.isEmpty(T)&&g.isString(T)||(T=h.get(j),T&&n.$broadcast(R,!0)),T}function N(){T=null,h.remove(j),n.$broadcast(R,!1),n.$broadcast(b,{user:null,permissions:[]}),_=null}var T,_,O,b="ngUserAuth:userPermissionsChanged",R="ngUserAuth:userLoginStateChanged",j="user.token",x={isLoggedIn:p,login:P,logout:I,getApiEndpoint:S,getAbortRequestsUrlPrefix:y,getDefaultLoggedInPermissionName:E,getUserToken:L,clearUserToken:N,getUserAuthInfo:k,goToLoginScreen:U,AUTH_INFO_CHANGED_EVENT_NAME:b,LOGIN_STATE_CHANGED_EVENT_NAME:R};return l(),x}n.$inject=["$rootScope","$injector","$location","$interval","lodash","localStorageService"];var e="/authentication",t="/unauthorized",r="requestedPath",o="/",i=[],s="token_read",u={enabled:!1,checkUrl:"/sessioncheck",interval:3e4,onSessionInvalid:function(){}};this.setApiEndpoint=function(n){e=n},this.setUnauthorizedUrl=function(n){t=n},this.setRequestedPathParameterName=function(n){r=n},this.setAbortRequestsUrlPrefix=function(n){o=n},this.addLogoutAction=function(n){i.push(n)},this.setDefaultLoggedInPermissionName=function(n){s=n},this.setSessionCheckSettings=function(n){u=n},this.getOtherwiseRouteHandler=function(n){var e=!1;return function(t,r){var o=t.get("ngUserAuthService"),i=r.path(),s=encodeURIComponent(n);(o.isLoggedIn()||i.indexOf(n)<0&&i.indexOf(s)<0)&&(e||(r.url(n),e=!0))}},this.$get=n}angular.module("ngUserAuth.service",["ngLodash","LocalStorageModule"]).provider("ngUserAuthService",n)}(),function(){"use strict";function n(n,e){function t(n){n=n||{};var t=e.getAbortRequestsUrlPrefix();t&&n.url.indexOf(t)<0&&(n.noCancelOnRouteChange=!0),void 0!==n.timeout||n.noCancelOnRouteChange||(n.$timeout=i(),n.timeout=n.$timeout.promise);var r=e.getUserToken();return r&&(n.headers=n.headers||{},n.headers.Authorization="Bearer "+r),n}function r(n){return s(n.config),n}function o(t){return t.config&&t.config.timeout&&t.config.timeout.isGloballyCancelled?n.defer().promise:(s(t.config),401===t.status?(u(),e.clearUserToken(),e.goToLoginScreen()):403===t.status&&(t.hasNoAccess=!0),n.reject(t))}function i(){var e=n.defer();return c.push(e),e}function s(n){if(n&&n.$timeout){var e=c.indexOf(n.$timeout);e>=0&&c.splice(e,1)}}function u(){angular.forEach(c,function(n){n.promise.isGloballyCancelled=!0,n.resolve()}),c.length=0}var c=[];return{request:t,response:r,responseError:o}}n.$inject=["$q","ngUserAuthService"],angular.module("ngUserAuth.interceptor",["ngUserAuth.service"]).factory("ngUserAuthInterceptor",n)}(),function(){"use strict";function n(n,e,t,r){function o(){$=e.isLoggedIn(),t.$on(e.LOGIN_STATE_CHANGED_EVENT_NAME,function(n,e){$=e}),I=n.defer(),S=!1,e.getUserAuthInfo().then(f,g),i(f)}function i(n){t.$on(e.AUTH_INFO_CHANGED_EVENT_NAME,function(e,t){n(t)})}function s(){return $}function u(){return I.promise}function c(){return S}function a(){return p}function f(n){I.resolve(),S=!0,p=n.user,P=n.permissions}function g(n){I.reject(n),S=!0}function h(n){var e=m(n);return 0===e.length?!0:A(e)}function l(n){var e=m(n);return 0===e.length?!0:v(e)}function d(n){var e=m(n);return 0===e.length?!0:!v(e)}function A(n){return r.every(n,function(n){return r.includes(P,n)})}function v(n){return r.some(n,function(n){return r.includes(P,n)})}function m(n){return void 0===n||r.isEmpty(n)?[]:r.isArray(n)?n:[n]}function U(n,e,t){return h(n)&&l(e)&&d(t)}var $,p,P,I,S,y={notifyOnAuthChange:i,isLoggedIn:s,isReady:c,whenReady:u,getUser:a,userHasPermission:h,userHasAnyPermission:l,userLacksPermission:d,checkPermissions:U};return o(),y}n.$inject=["$q","ngUserAuthService","$rootScope","lodash"],angular.module("ngUserAuthInfo.service",["ngUserAuth.service","ngLodash"]).factory("ngUserAuthInfoService",n)}(),function(){"use strict";function n(n,e,t,r,o){function i(n,e,i){if(!e.data||!e.data.anonymousAccessAllowed){var u=s(e);u.needsCheck&&(r.whenReady().then(function(){var s=r.checkPermissions(u.hasPermission,u.hasAnyPermission,u.lacksPermission);r.isLoggedIn()?s?n.defaultPrevented&&o.go(e.name,i):c(u.redirectTo,i):t.goToLoginScreen(e)},function(){return o.go("error",i)}),r.isReady()&&r.isLoggedIn()||n.preventDefault())}}function s(n){var e,r,o,i=[];return n.data&&(i=u(n.data.hasPermission),e=n.data.hasAnyPermission,r=n.data.lacksPermission,o=n.data.redirectTo),n&&n.data&&n.data.anonymousAccessAllowed||i.push(t.getDefaultLoggedInPermissionName()),{hasPermission:i,hasAnyPermission:e,lacksPermission:r,redirectTo:o,needsCheck:i.length>0||e||r}}function u(n){return n?e.isArray(n)?n:[n]:[]}function c(n,e){return n?(angular.isFunction(n)&&(n=n()),o.go(n,e)):o.go("forbidden",e)}n.$on("$stateChangeStart",i)}n.$inject=["$rootScope","lodash","ngUserAuthService","ngUserAuthInfoService","$state"],angular.module("ngUserAuth.run",["ngLodash","ngUserAuth.service","ngUserAuthInfo.service","ui.router"]).run(n)}(),function(){"use strict";angular.module("ngUserAuth",["ngUserAuth.config","ngUserAuth.directive","ngUserAuth.interceptor","ngUserAuth.run","ngUserAuth.service","ngUserAuthInfo.service"])}(),function(){"use strict";function n(n,e){function t(t,r,o){function i(){e.checkPermissions(u,c,a)?r.show():r.hide()}var s=n.$new(!0),u=s.$eval(o.hasPermission)||o.hasPermission,c=s.$eval(o.hasAnyPermission)||o.hasAnyPermission,a=s.$eval(o.lacksPermission)||o.lacksPermission;i(),e.notifyOnAuthChange(i)}var r={link:t};return r}n.$inject=["$rootScope","ngUserAuthInfoService"],angular.module("ngUserAuth.directive",["ngUserAuthInfo.service"]).directive("ngUserAuth",n)}(),function(){"use strict";function n(n){n.interceptors.push("ngUserAuthInterceptor")}n.$inject=["$httpProvider"],angular.module("ngUserAuth.config",[]).config(n)}();