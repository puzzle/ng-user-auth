/**
 * ng-user-auth 1.0.7
 * (c) 2016 
 * License: Apache-2.0
 */
!function(){"use strict";function e(){function e(e,u,c,a,g){function f(){return c.get("$http")}function h(e){u.forEach(i,function(e){e(c)});var n=g.path(),o=d(n);"/"===g.$$search[r]&&e&&e.url?g.url(t+"?"+r+"="+e.url):!(n.indexOf(t)<0)||o&&o.data&&o.data.anonymousAccessAllowed||g.url(t+"?"+r+"="+n)}function d(e){var n=c.get("$state").get(),t=u.findIndex(n,function(n){return n.url===e});return n[t]}function l(){var e=I();return!!e&&u.isString(e)}function A(e){return S=f().post(n,e).then(P)}function m(){return f()["delete"](n,{noCancelOnRouteChange:!0})["finally"](function(){y()})}function v(){return n}function U(){return o}function $(){return s}function p(){return S||(S=f().get(n).then(P)),S}function P(n){var t=n.data;return t.token&&(E=t.token,a.set(k,E),e.$broadcast(N,!0)),e.$broadcast(L,t),t}function I(){return E&&!u.isEmpty(E)&&u.isString(E)||(E=a.get(k),E&&e.$broadcast(N,!0)),E}function y(){E=null,a.remove(k),e.$broadcast(N,!1),e.$broadcast(L,{user:null,permissions:[]}),S=null}var E,S,L="ngUserAuth:userPermissionsChanged",N="ngUserAuth:userLoginStateChanged",k="user.token",C={isLoggedIn:l,login:A,logout:m,getApiEndpoint:v,getAbortRequestsUrlPrefix:U,getDefaultLoggedInPermissionName:$,getUserToken:I,clearUserToken:y,getUserAuthInfo:p,goToLoginScreen:h,AUTH_INFO_CHANGED_EVENT_NAME:L,LOGIN_STATE_CHANGED_EVENT_NAME:N};return C}e.$inject=["$rootScope","lodash","$injector","localStorageService","$location"];var n="/authentication",t="/unauthorized",r="requestedPath",o="/",i=[],s="token_read";this.setApiEndpoint=function(e){n=e},this.setUnauthorizedUrl=function(e){t=e},this.setRequestedPathParameterName=function(e){r=e},this.setAbortRequestsUrlPrefix=function(e){o=e},this.addLogoutAction=function(e){i.push(e)},this.setDefaultLoggedInPermissionName=function(e){s=e},this.getOtherwiseRouteHandler=function(e){var n=!1;return function(t,r){var o=t.get("ngUserAuthService"),i=r.path(),s=encodeURIComponent(e);(o.isLoggedIn()||i.indexOf(e)<0&&i.indexOf(s)<0)&&(n||(r.url(e),n=!0))}},this.$get=e}angular.module("ngUserAuth.service",["ngLodash","LocalStorageModule"]).provider("ngUserAuthService",e)}(),function(){"use strict";function e(e,n){function t(e){e=e||{};var t=n.getAbortRequestsUrlPrefix();t&&e.url.indexOf(t)<0&&(e.noCancelOnRouteChange=!0),void 0!==e.timeout||e.noCancelOnRouteChange||(e.$timeout=i(),e.timeout=e.$timeout.promise);var r=n.getUserToken();return r&&(e.headers=e.headers||{},e.headers.Authorization="Bearer "+r),e}function r(e){return s(e.config),e}function o(t){return t.config&&t.config.timeout&&t.config.timeout.isGloballyCancelled?e.defer().promise:(s(t.config),401===t.status?(u(),n.clearUserToken(),n.goToLoginScreen()):403===t.status&&(t.hasNoAccess=!0),e.reject(t))}function i(){var n=e.defer();return c.push(n),n}function s(e){if(e&&e.$timeout){var n=c.indexOf(e.$timeout);n>=0&&c.splice(n,1)}}function u(){angular.forEach(c,function(e){e.promise.isGloballyCancelled=!0,e.resolve()}),c.length=0}var c=[],a={request:t,response:r,responseError:o};return a}e.$inject=["$q","ngUserAuthService"],angular.module("ngUserAuth.interceptor",["ngUserAuth.service"]).factory("ngUserAuthInterceptor",e)}(),function(){"use strict";function e(e,n,t,r){function o(){$=n.isLoggedIn(),t.$on(n.LOGIN_STATE_CHANGED_EVENT_NAME,function(e,n){$=n}),I=e.defer(),y=!1,n.getUserAuthInfo().then(g,f),i(g)}function i(e){t.$on(n.AUTH_INFO_CHANGED_EVENT_NAME,function(n,t){e(t)})}function s(){return $}function u(){return I.promise}function c(){return y}function a(){return p}function g(e){I.resolve(),y=!0,p=e.user,P=e.permissions}function f(e){I.reject(e),y=!0}function h(e){var n=v(e);return 0===n.length?!0:A(n)}function d(e){var n=v(e);return 0===n.length?!0:m(n)}function l(e){var n=v(e);return 0===n.length?!0:!m(n)}function A(e){return r.every(e,function(e){return r.includes(P,e)})}function m(e){return r.some(e,function(e){return r.includes(P,e)})}function v(e){return void 0===e||r.isEmpty(e)?[]:r.isArray(e)?e:[e]}function U(e,n,t){return h(e)&&d(n)&&l(t)}var $,p,P,I,y,E={notifyOnAuthChange:i,isLoggedIn:s,isReady:c,whenReady:u,getUser:a,userHasPermission:h,userHasAnyPermission:d,userLacksPermission:l,checkPermissions:U};return o(),E}e.$inject=["$q","ngUserAuthService","$rootScope","lodash"],angular.module("ngUserAuthInfo.service",["ngUserAuth.service","ngLodash"]).factory("ngUserAuthInfoService",e)}(),function(){"use strict";function e(e,n,t,r,o){function i(e,n,i){if(!n.data||!n.data.anonymousAccessAllowed){var u=s(n);u.needsCheck&&(r.whenReady().then(function(){var s=r.checkPermissions(u.hasPermission,u.hasAnyPermission,u.lacksPermission);r.isLoggedIn()?s?e.defaultPrevented&&o.go(n.name,i):c(u.redirectTo,i):t.goToLoginScreen(n)},function(){return o.go("error",i)}),r.isReady()&&r.isLoggedIn()||e.preventDefault())}}function s(e){var n,r,o,i=[];return e.data&&(i=u(e.data.hasPermission),n=e.data.hasAnyPermission,r=e.data.lacksPermission,o=e.data.redirectTo),e&&e.data&&e.data.anonymousAccessAllowed||i.push(t.getDefaultLoggedInPermissionName()),{hasPermission:i,hasAnyPermission:n,lacksPermission:r,redirectTo:o,needsCheck:i.length>0||n||r}}function u(e){return e?n.isArray(e)?e:[e]:[]}function c(e,n){return e?(angular.isFunction(e)&&(e=e()),o.go(e,n)):o.go("forbidden",n)}e.$on("$stateChangeStart",i)}e.$inject=["$rootScope","lodash","ngUserAuthService","ngUserAuthInfoService","$state"],angular.module("ngUserAuth.run",["ngLodash","ngUserAuth.service","ngUserAuthInfo.service","ui.router"]).run(e)}(),function(){"use strict";angular.module("ngUserAuth",["ngUserAuth.config","ngUserAuth.directive","ngUserAuth.interceptor","ngUserAuth.run","ngUserAuth.service","ngUserAuthInfo.service"])}(),function(){"use strict";function e(e,n){function t(t,r,o){function i(){n.checkPermissions(u,c,a)?r.show():r.hide()}var s=e.$new(!0),u=s.$eval(o.hasPermission)||o.hasPermission,c=s.$eval(o.hasAnyPermission)||o.hasAnyPermission,a=s.$eval(o.lacksPermission)||o.lacksPermission;i(),n.notifyOnAuthChange(i)}var r={link:t};return r}e.$inject=["$rootScope","ngUserAuthInfoService"],angular.module("ngUserAuth.directive",["ngUserAuthInfo.service"]).directive("ngUserAuth",e)}(),function(){"use strict";function e(e){e.interceptors.push("ngUserAuthInterceptor")}e.$inject=["$httpProvider"],angular.module("ngUserAuth.config",[]).config(e)}();